<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>popup-input组件</title>
    <link rel="stylesheet" href="../../asset/css/common.css">
    <link rel="stylesheet" href="../../asset/libs/prism.js-1.17.1/prism_light.css">
    <!--辅助: 代码高亮样式, 正式页面不需要引用-->
</head>

<body>
    <div id="app" class="warpper" v-cloak>
        <div class="header">
            <ul>
                <li class="home"><a href="#"><img src="../../asset/images/icon-home.png" alt="回到首页"></a></li>
                <li>|</li>
                <li> PopupInput，弹窗组件</li>
            </ul>
        </div>
        <div class="block_container">
            <div class="title">
                PopupInput，弹窗组件
            </div>
            <div class="content">
                <table class="table_layout_edit">
                    <tr>
                        <td class="required">PopupInput1，同步value和text</td>
                        <td>
                            <popup-input popup-url="component-popup-test.html" :text.sync="text1" :value.sync="value1">
                            </popup-input>
                        </td>
                        <td class="required">字段</td>
                        <td>
                            <p class="detail_line">text1: {{text1}}<br>value1: {{value1}}</p>
                        </td>
                    </tr>
                    <tr>
                        <td class="required">PopupInput2，value为数组，只同步value不同步text</td>
                        <td>
                            <popup-input popup-url="component-popup-test.html" :text="text2" :value.sync="value2">
                            </popup-input>
                        </td>
                        <td class="required">字段</td>
                        <td>
                            <p class="detail_line">text2: {{text2}}<br>value2: {{value2}}</p>
                        </td>
                    </tr>
                    <tr>
                        <td>button类型</td>
                        <td>
                            <popup-input popup-url="component-popup-test.html" button-mode="true" button-text="选择值"
                                :after-popup="afterPopup"></popup-input>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="block_container language-markup">
            <div class="title">
                组件说明
            </div>
            <div class="content">
                <div class="sy_group">
                    <code>&lt;popup-input>&lt;/popup-input></code><br>
                </div>
                <div class="block_overflow">
                    <table class="table_list table_striped table_hover">
                        <thead>
                            <tr>
                                <th>属性</th>
                                <th>说明</th>
                                <th>类型</th>
                                <th>必填</th>
                                <th>不传时默认值</th>
                                <th>自动检测父页面值变化</th>
                                <th>支持.sync</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="nowrap">:text</td>
                                <td>组件显示文本，一般情况下只需要在初始化时传值供显示，后续由组件根据选择值维护显示文本</td>
                                <td>字符串</td>
                                <td>否</td>
                                <td>''</td>
                                <td>是</td>
                                <td>是</td>
                            </tr>
                            <tr>
                                <td class="nowrap">:value</td>
                                <td>组件值</td>
                                <td>基本类型/对象/数组</td>
                                <td>否</td>
                                <td>undefined</td>
                                <td>是</td>
                                <td>是</td>
                            </tr>
                            <tr>
                                <td class="nowrap">rows</td>
                                <td>组件行数</td>
                                <td>整数</td>
                                <td>否</td>
                                <td>1</td>
                                <td>是</td>
                                <td>否</td>
                            </tr>
                            <tr>
                                <td class="nowrap">popup-url</td>
                                <td>弹窗页面地址</td>
                                <td>字符串</td>
                                <td>是</td>
                                <td>无</td>
                                <td>是</td>
                                <td>否</td>
                            </tr>
                            <tr>
                                <td class="nowrap">popup-title</td>
                                <td>弹窗标题</td>
                                <td>字符串</td>
                                <td>否</td>
                                <td>''</td>
                                <td>是</td>
                                <td>否</td>
                            </tr>
                            <tr>
                                <td class="nowrap">popup-width</td>
                                <td>弹窗宽度，支持px绝对值或%百分比值</td>
                                <td>字符串</td>
                                <td>否</td>
                                <td>'85%'</td>
                                <td>是</td>
                                <td>否</td>
                            </tr>
                            <tr>
                                <td class="nowrap">popup-height</td>
                                <td>弹窗高度，支持px绝对值或%百分比值</td>
                                <td>字符串</td>
                                <td>否</td>
                                <td>'70%'</td>
                                <td>是</td>
                                <td>否</td>
                            </tr>
                            <tr>
                                <td class="nowrap">button-mode</td>
                                <td>按钮模式，为true时不显示文本框，仅显示按钮</td>
                                <td>布尔值</td>
                                <td>否</td>
                                <td>false</td>
                                <td>是</td>
                                <td>否</td>
                            </tr>
                            <tr>
                                <td class="nowrap">button-text</td>
                                <td>按钮文本，只有button-mode为true时才生效</td>
                                <td>字符串</td>
                                <td>否</td>
                                <td>'选择'</td>
                                <td>是</td>
                                <td>否</td>
                            </tr>
                            <tr>
                                <td class="nowrap">button-class</td>
                                <td>按钮样式，只有button-mode为true时才生效</td>
                                <td>字符串</td>
                                <td>否</td>
                                <td>'btn-default'</td>
                                <td>是</td>
                                <td>否</td>
                            </tr>
                            <tr>
                                <td class="nowrap">disabled</td>
                                <td>禁用</td>
                                <td>布尔值</td>
                                <td>否</td>
                                <td>false</td>
                                <td>是</td>
                                <td>否</td>
                            </tr>
                            <tr>
                                <td class="nowrap">:before-popup</td>
                                <td>弹出前事件</td>
                                <td>function()，由页面提供组件调用，返回值为true/false，表示是否弹出选择页面<br>
                                    需注意，before-popup中的ajax调用必须设置async为false</td>
                                <td>否</td>
                                <td>undefined</td>
                                <td>是</td>
                                <td>否</td>
                            </tr>
                            <tr>
                                <td class="text-nowrap">:after-popup</td>
                                <td>关闭选择页面前事件, 参数: value (选择页面返回值value)</td>
                                <td>function()，由页面提供组件调用，返回值为true/false，表示是否关闭选择页面<br>
                                    需注意，after-popup中的ajax调用必须设置async为false</td>
                                <td>否</td>
                                <td>undefined</td>
                                <td>是</td>
                                <td>否</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="block_overflow">
                    <table class="table_list table_striped table_hover">
                        <tr>
                            <th>事件</th>
                            <th>说明</th>
                            <th>参数</th>
                        </tr>
                        <tr>
                            <td class="nowrap">@popup-change</td>
                            <td>选择值发生变化时回调方法</td>
                            <td>value：组件值，text：组件显示文本，selectedObject: 选中的对象</td>
                        </tr>
                    </table>
                </div>
                <div class="block_overflow">
                    <table class="table_list table_striped table_hover">
                        <tr>
                            <th>方法</th>
                            <th>说明</th>
                            <th>参数</th>
                            <th>返回值</th>
                        </tr>
                        <tr>
                            <td class="nowrap">getValue()</td>
                            <td>获取组件值</td>
                            <td>无</td>
                            <td>基本类型/对象/数组，由弹出页面设置</td>
                        </tr>
                        <tr>
                            <td class="nowrap">getText()</td>
                            <td>获取组件显示文本</td>
                            <td>无</td>
                            <td>字符串</td>
                        </tr>
                    </table>
                </div>
                <p>
                    注意：<br>
                    1、PopupInput支持嵌套，但要注意设置嵌套的窗口大小，否则内部再弹出的窗口将显示不全。<br>
                    2、点击清除按钮时会将组件text设为''，组件value设为undefined。<br>
                </p>
                <p>
                    <code>弹出页面处理逻辑</code><br>
                    参考component-popup-test.html，代码如下，关键的是其中标注释的代码：
                </p>
                <pre><code class="language-js">require(['jquery', 'vue', 'global'], function ($, Vue) {
    var app = new Vue({
        el: '#app',
        data: function () {
            return {
            }
        },
        created: function () {
            window.returnPopupInputText = this.getText;         //注册取显示文本方法供组件调用
            window.returnPopupInputValue = this.getValue;       //注册取值方法供组件调用
            window.beforePopupReturn = this.beforePopupReturn;  //注册弹窗返回前事件供组件调用，可用于在弹窗内验证选择的值

            var popupInputText = parent.getPopupInputText();    //获取组件的显示文本，如用不到可省略
            var popupInputValue = parent.getPopupInputValue();  //获取组件值
            //if(popupInputValue == undefined)                  //如果值为对象或数组类型，为使页面正确判断，可在此进行判断并实始化空值
            //    popupInputValue = ...;
        },
        methods: {
            getText: function () {
                 return ...;                                    //返回显示文件给组件，字符串
            },
            getValue: function () {
                 return ...;                                    //返回值给组件，与组件提供的值类型一致
            },
            beforePopupReturn:function() {
                return true;                                    //返回true关闭弹窗，返回false不关闭弹窗
            }
        }
    });
});</code></pre>

            </div>
        </div>
    </div>

    <script type="text/javascript" src="../../asset/libs/require.js-2.3.6/require.min.js"></script>
    <script type="text/javascript" src="../../asset/js/require-config.js"></script>
    <script type="text/javascript" src="../../asset/libs/prism.js-1.17.1/prism.js"></script>
    <!--辅助: 代码高亮, 正式页面不需要引用-->
    <script type="text/javascript">
        require(['jquery', 'vue', 'global'], function ($, Vue) {
            var app = new Vue({
                el: '#app',
                data: function () {
                    return {
                        text1: 'text1',
                        value1: 'value1',
                        text2: 'text2',
                        value2: ['value2_1', 'value2_2']
                    }
                },
                created: function () {

                },
                methods: {
                    afterPopup: function (value) { // value: 选择页面返回值value
                        if (value == undefined) {
                            layer.msg('报错');
                            return false
                        } else {
                            return true
                        }
                    }
                }
            })
        });
    </script>
</body>

</html>